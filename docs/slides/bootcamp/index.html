<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Sirota Lab â€” Progressive, Reproducible Workflow Bootcamp</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/reveal.js@5/dist/reveal.css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/reveal.js@5/dist/theme/black.css" id="theme" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/reveal.js@5/plugin/highlight/monokai.css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/reveal.js-copycode@1.3.2/plugin/copycode/copycode.css" />
  <style>
    .footnote{position:absolute;bottom:10px;right:20px;font-size:.55em;opacity:.7}
    .reveal h1,.reveal h2{letter-spacing:.5px}
    .reveal section img{border-radius:8px}
    .reveal pre code{font-size:.9em}
    .reveal {
      font-size: 24px; /* default is ~32px */
    }
  </style>
</head>
<body>
  <div class="reveal"><div class="slides">
    <section data-markdown
             data-separator="^\n---\n$"
             data-separator-vertical="^\n--\n$"
             data-separator-notes="^Note:"
             data-charset="utf-8">
      <textarea data-template>


# Bootcamp II
### *Snakebids*

---

## Tutorial Overview

1. VSCode SSH Workspace
2. Terminal Setup
3. explore `sirocampus` and install `ds-bidsmini`
4. Part I: Snakemake
5. Part II: Snakebids

---

## 1. VSCode SSH Workspace

---

### 1.0 Open VSCode

Press

```
Ctrl + Shift + P
```

A command box will appear.

---

### 1.1 Connect via Remote-SSH

Type and select:

```
Remote-SSH: Connect to Host...
```

Enter your host: beta

If no hosts are being shown then type:
```bash
<user>@beta
```

Enter your **password** when prompted.

---

### 1.2 Create a tutorial folder

Open VSCode terminal

```bash
Ctrl + J
```

In the VSCode terminal, run:

```bash
# I have mine under
snakebidsdir="/storage2/arash/tutorials/snakebids"

snakebidsdir="/path/to/.../tutorials/snakebids"

mkdir -p $snakebidsdir

# change dir
cd $snakebidsdir
```

copy the absolute path to `snakebids` directory (without quotation marks)

---

### 1.3 VSCode: Open Folder

Select:

```
Open Folder
```

By default, `/home/<user>` will appear. Replace it by pasting the absolute path of the `snakebids` folder.

When prompted, select:

> âœ… Yes, I trust the authors

---

### 1.4 VSCode: panels
toggle File explorer
```
Ctrl + B
```
toggle terminal
```
Ctrl + J
```

---

## 2. Terminal Setup

---

### 2. Terminal Setup

UMASK for contirbution (optional)

```bash
# set umask so that new file creation preserves group permissions
echo 'umask 0002' >> ~/.bashrc
```

***Warning***: it means under shared folders others can modify files created by you if the group permissions allow it.

---

### 2.1 make an alias 

```bash
# --- Create ~/.bash_aliases ---
cat <<'EOT' > ~/.bash_aliases
export riastoreshared=/storage/share/git/ria-store
EOT
```

---

### 2.2 More Setup

If you don't already have the following in `bashrc`, add it by running:
```bash
# --- Append to ~/.bashrc ---
cat <<'EOT' >> ~/.bashrc

# Alias definitions.
# You may want to put all your additions into a separate file like
# ~/.bash_aliases, instead of adding them here directly.
# See /usr/share/doc/bash-doc/examples in the bash-doc package.

if [ -f ~/.bash_aliases ]; then
    . ~/.bash_aliases
fi

if [ -f ~/.bash_functions ]; then
    . ~/.bash_functions
fi
EOT
```

---

### 2.3 add `conda-shared` alias

```bash
# Shared conda
cat <<'EOT' >> ~/.bashrc
alias conda-shared='source /storage/share/python/environments/Anaconda3/etc/profile.d/conda.sh && echo "â†’ Using shared Conda"'
EOT
```

---

### 2.4 Setup finished: resource bashrc and activate the `cogpy` environment
```bash
# --- Reload bash configuration ---
source ~/.bashrc
```

```bash
conda-shared
conda activate cogpy
```

have a look at available conda environments
```bash
conda env list
```


---

## 3.  `sirocampus`

---

### 3.0 Clone `sirocampus`

```bash
# navigate to your base folder
cd /storage<storage-number>/<name>/
# mine is: /storage2/arash
```

install the `sirocampus`:

```bash
datalad install -s "ria+file://$riastoreshared#~sirocampus" sirocampus
```

---

### 3.1 `sirocampus` tree

run:
```bash
tree -L 3 sirocampus
```

output:
```bash
```bash
sirocampus (the sirotalab super repository)
â”œâ”€â”€ bib 
â”‚   â””â”€â”€ ...
â”œâ”€â”€ data
â”‚   â””â”€â”€ ...
â”œâ”€â”€ docs
â”‚   â””â”€â”€ ...
â””â”€â”€ code
    â””â”€â”€ ...
```

---

### 3.1 `sirocampus` tree

```bash
```bash
sirocampus
â”œâ”€â”€ bib (lab paper pool > linked with Zotero)
â”‚   â”œâ”€â”€ metadata
â”‚   â””â”€â”€ pdfs
â”œâ”€â”€ data
â”‚   â””â”€â”€ ...
â”œâ”€â”€ docs
â”‚   â””â”€â”€ ...
â””â”€â”€ code
    â””â”€â”€ ...
```

run:
```bash
cd sirocampus
datalad get -n bib
```

---

### 3.2 `sirocampus:bib`

run:
```bash
ls -l bib/pdfs/
```

to download a paper, run:
```bash
datalad get bib/pdfs/<paper name>
```

---

### 3.3 `sirocampus:data`

```bash
sirocampus (the sirotalab super repository)
â”œâ”€â”€ bib (lab paper pool > linked with Zotero)
â”œâ”€â”€ data (datalad superdataset containing all sirota lab datasets)
â”‚   â”œâ”€â”€ ds-bidsmini
â”‚   â”œâ”€â”€ ds-msol
â”‚   â”œâ”€â”€ ds-gecog
â”‚   â”œâ”€â”€ ds-pixecog
â”‚   â””â”€â”€ ... 
â”œâ”€â”€ docs
â”‚   â””â”€â”€ ...
â””â”€â”€ code
    â””â”€â”€ ...
```

---

### 3.3 `sirocampus:data`

```bash
sirocampus (the sirotalab super repository)
â”œâ”€â”€ bib (lab paper pool > linked with Zotero)
â”œâ”€â”€ data (datalad superdataset containing all sirota lab datasets)
â”‚   â”œâ”€â”€ ds-bidsmini
â”‚   â”œâ”€â”€ ds-msol
â”‚   â”œâ”€â”€ ds-gecog
â”‚   â”œâ”€â”€ ds-pixecog
â”‚   â””â”€â”€ ... To be added by you ğŸ¨! 
â”œâ”€â”€ docs
â”‚   â””â”€â”€ ...
â””â”€â”€ code
    â””â”€â”€ ...
```

---

### 3.4 `sirocampus:docs` 

Diataxis framework: https://diataxis.fr/

two axes:
cognition -> action
acquisition -> application

widely adopted by tools for documentation (e.g. pytest, ...)

---

### 3.4 `sirocampus:docs` 

```bash
```bash
sirocampus (the sirotalab super repository)
â”œâ”€â”€ bib 
â”œâ”€â”€ data
â”œâ”€â”€ docs (lab documents based on Diataxis framework)
â”‚   â”œâ”€â”€ logs
â”‚   â”œâ”€â”€ how-to
â”‚   â”œâ”€â”€ reference
â”‚   â”œâ”€â”€ tutorials > snakebids.md
â”‚   â””â”€â”€ explanation
â””â”€â”€ code
    â””â”€â”€ ...
```

### 3.4 `sirocampus:docs` lab wiki 

easy contribution to lab wiki

```bash
```bash
sirocampus (the sirotalab super repository)
â”œâ”€â”€ bib 
â”œâ”€â”€ data
â”œâ”€â”€ docs (lab documents based on Diataxis framework)
â”‚   â”œâ”€â”€ wiki (markdown version of all lab dokuwiki files)
â”‚   â”œâ”€â”€ logs
â”‚   â”œâ”€â”€ how-to
â”‚   â”œâ”€â”€ reference
â”‚   â”œâ”€â”€ tutorials > snakebids.md
â”‚   â””â”€â”€ explanation
â””â”€â”€ code
    â””â”€â”€ ...
```

automatic conversion between dokuwiki and markdown formats.

---

### 3.5 `sirocampus:code`

```bash
```bash
sirocampus (the sirotalab super repository)
â”œâ”€â”€ bib 
â”œâ”€â”€ data
â”œâ”€â”€ docs
â””â”€â”€ code (sirota lab code)
    â”œâ”€â”€ lib (library of third-party tools)
    â”œâ”€â”€ cogpy (ecog package)
    â”œâ”€â”€ labbox (lab MATLAB toolbox)
    â””â”€â”€ labpy (lab Python package)
```

---

### 3.6 `sirocampus` tree

```bash
```bash
sirocampus (the sirotalab super repository)
â”œâ”€â”€ bib (lab paper pool > linked with Zotero)
â”œâ”€â”€ data (datalad superdataset containing all sirota lab datasets)
â”‚   â”œâ”€â”€ ds-bidsmini
â”‚   â”œâ”€â”€ ds-msol
â”‚   â”œâ”€â”€ ds-gecog
â”‚   â”œâ”€â”€ ds-pixecog
â”‚   â””â”€â”€ ... To be added by you ğŸ¨! 
â”œâ”€â”€ docs (lab documents based on Diataxis framework)
â”‚   â”œâ”€â”€ logs
â”‚   â”œâ”€â”€ how-to
â”‚   â”œâ”€â”€ reference
â”‚   â”œâ”€â”€ tutorials
â”‚   â””â”€â”€ explanation
â””â”€â”€ code (sirota lab code)
    â”œâ”€â”€ lib (library of third-party tools)
    â”œâ”€â”€ cogpy (ecog package)
    â”œâ”€â”€ labbox (lab MATLAB toolbox)
    â””â”€â”€ labpy (lab Python package)
```


---

## 4.  `snakemake`

---

### 4.0 create a mini bids

Create a **tiny BIDS-style dataset** with:

- 2 subjects: `sub-01`, `sub-02`
    
- 2 sessions per subject: `ses-01`, `ses-02`
    
- Small dummy motion CSV files in each session directory
    

---

# ğŸ“ Desired Structure

```
sub-01/
  ses-01/
    motion/
      sub-01_ses-01_motion.csv
  ses-02/
    motion/
      sub-01_ses-02_motion.csv
sub-02/
  ses-01/
    motion/
      sub-02_ses-01_motion.csv
  ses-02/
    motion/
      sub-02_ses-02_motion.csv
```

---

# âš™ï¸ Bash Command

```bash
#!/bin/bash

# Create BIDS-like directory structure
for sub in 01 02; do
  for ses in 01 02; do
    mkdir -p sub-${sub}/ses-${ses}/motion
    # Create a tiny dummy motion CSV file (<1MB)
    echo "time,dx,dy,dz,rx,ry,rz" > sub-${sub}/ses-${ses}/motion/sub-${sub}_ses-${ses}_motion.csv
    echo "0,0.1,0.2,0.3,0.01,0.02,0.03" >> sub-${sub}/ses-${ses}/motion/sub-${sub}_ses-${ses}_motion.csv
    echo "1,0.2,0.3,0.4,0.02,0.03,0.04" >> sub-${sub}/ses-${ses}/motion/sub-${sub}_ses-${ses}_motion.csv
  done
done
```

---

# âœ… Result

- Four CSV files created
    
- Each file only a few bytes (tiny)
    
- Ready for testing or demonstration
    

```
sub-{01,02}/ses-{01,02}/motion/sub-<label>_ses-<label>_motion.csv
```

Perfect â€” hereâ€™s the **ultra-simple single-file Snakemake example**, using literal paths and no lambdas or wildcards.  
It just processes one file: `raw/sub-01/ses-01/motion/sub-01_ses-01_motion.csv`.

---

### 4.1.1 _SingleFile_: Create Snakefile

```bash
# Snakefile (single-file, literal paths only)

configfile: "config.yaml"

rule all:
    input:
        "derivatives/pipeline/sub-01/ses-01/motion/sub-01_ses-01_motion_copy.csv"

rule copy_motion:
    input:
        "raw/sub-01/ses-01/motion/sub-01_ses-01_motion.csv"
    output:
        "derivatives/pipeline/sub-01/ses-01/motion/sub-01_ses-01_motion_copy.csv"
    shell:
        """
        mkdir -p $(dirname {output})
        cp {input} {output}
        echo 'Copied {input} to {output}'
        """
```

---

### 4.1.2 _SingleFile_: Run `snakemake`

```bash
snakemake -c 1
```

This will:

- Create the output folder `derivatives/pipeline/sub-01/ses-01/motion/`
    
- Copy the CSV file from `raw/`
    
- Print a simple confirmation message
    

---

### 4.1.3 _SingleFile_: Check the logs

under `.snakemake`

---

### 4.1.4 _SingleFile_: Create config file

Include a minimal config file (even if not used much yet):

```bash
# config.yaml
raw_dir: raw
out_dir: derivatives/pipeline
subject: "01"
session: "01"
```

---

### 4.1.5 _SingleFile_: Run `snakemake`

Same simple execution â€” config is just declared for consistency:

```bash
snakemake -c 1
```

âœ… **Result:**  
A working minimal Snakemake pipeline that copies one literal file (`sub-01/ses-01`) from `raw/` to `derivatives/pipeline/`.


---

### 4.2.1 *MultiFile*: Create Snakefile

---

### 4.2.2 *MultiFile*: Run `snakemake`

---

## 4.  `snakebids`

---

### 5.1 *snakebids*: Create Snakefile

---

### 5.2 *snakebids*: Run `snakemake`

---




      </textarea>
    </section>
  </div></div>
  <script src="https://cdn.jsdelivr.net/npm/reveal.js@5/dist/reveal.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/reveal.js@5/plugin/markdown/markdown.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/reveal.js@5/plugin/notes/notes.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/reveal.js@5/plugin/highlight/highlight.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/reveal.js-copycode@1.3.2/plugin/copycode/copycode.js"></script>
  <script>
    Reveal.initialize({
      hash: true,
      slideNumber: true,
      navigationMode: 'linear',
      width: 1280, height: 720, margin: 0.04,
      pdfSeparateFragments: false, pdfMaxPagesPerSlide: 1,
      transition: 'slide', backgroundTransition: 'fade',
      copycode: { button: "hover", display: "icons", timeout: 1200 },
      plugins: [ RevealMarkdown, RevealNotes, RevealHighlight, CopyCode ]
    });
  </script>
</body>
</html>
